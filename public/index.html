<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Weather Sockets</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: Helvetica, sans-serif;
            background: linear-gradient(135deg, #e8e8e8 0%, #d3d3d3 100%);
            text-align: center; 
            padding: 50px 20px;
            margin: 0;
            min-height: 100vh;
        }
        
        .card { 
            background: #f5f5f5;
            max-width: 450px; 
            margin: 0 auto; 
            padding: 30px; 
            border-radius: 16px; 
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            border: 2px solid #b0b0b0;
        }
        
        h2 {
            color: #2c2c2c;
            margin-top: 0;
            font-weight: 600;
            font-size: 24px;
        }
        
        select { 
            padding: 12px 16px; 
            width: 100%; 
            font-size: 16px; 
            margin-bottom: 25px;
            border-radius: 10px;
            border: 2px solid #a0a0a0;
            background: #ffffff;
            color: #2c2c2c;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        select:hover {
            border-color: #808080;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        select:focus {
            outline: none;
            border-color: #707070;
            box-shadow: 0 0 0 3px rgba(112, 112, 112, 0.2);
        }
        
        .temp-display { 
            font-size: 64px; 
            font-weight: 700; 
            color: #1a1a1a; 
            margin: 25px 0;
            padding: 20px;
            background: #e8e8e8;
            border-radius: 12px;
            border: 2px solid #b0b0b0;
        }
        
        .log { 
            text-align: left; 
            height: 180px; 
            overflow-y: auto; 
            background: #2c2c2c; 
            color: #a0e0a0; 
            font-family: monospace; 
            padding: 15px; 
            border-radius: 10px; 
            font-size: 13px;
            border: 2px solid #505050;
            line-height: 1.6;
        }
        
        .log::-webkit-scrollbar {
            width: 8px;
        }
        
        .log::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 10px;
        }
        
        .log::-webkit-scrollbar-thumb {
            background: #606060;
            border-radius: 10px;
        }
        
        .log::-webkit-scrollbar-thumb:hover {
            background: #707070;
        }
        
        .status { 
            font-size: 13px; 
            color: #606060; 
            margin-bottom: 15px;
            padding: 8px 12px;
            background: #e8e8e8;
            border-radius: 8px;
            border: 1px solid #c0c0c0;
            display: inline-block;
        }
        
        .status span {
            font-weight: 600;
            color: #404040;
        }
        
        p {
            color: #4a4a4a;
            margin: 15px 0 10px 0;
            font-weight: 500;
        }
        
        .highlight { 
            animation: flash 1s ease-in-out; 
        }
        
        @keyframes flash { 
            0% { 
                color: #606060; 
                border-color: #909090;
            } 
            50% {
                color: #1a1a1a;
                border-color: #707070;
            }
            100% { 
                color: #1a1a1a; 
                border-color: #b0b0b0;
            } 
        }
    </style>
</head>
<body>

    <div class="card">
        <h2>ðŸŒ¤ Live Weather Monitor</h2>
        <p class="status">Status: <span id="status">Disconnected</span></p>

        <select id="citySelector">
            <option value="" disabled selected>Select a location...</option>
            <option value="London">London</option>
            <option value="New York">New York</option>
            <option value="Tokyo">Tokyo</option>
        </select>

        <div id="display" class="temp-display">--Â°C</div>
        <p>Live Server Logs:</p>
        <div id="logs" class="log"></div>
    </div>

    <!-- Import Socket.io Client Library -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // UI Elements
        const citySelector = document.getElementById('citySelector');
        const tempDisplay = document.getElementById('display');
        const logBox = document.getElementById('logs');
        const statusSpan = document.getElementById('status');

        // 1. Check connection status
        socket.on('connect', () => {
            statusSpan.textContent = "Connected (ID: " + socket.id + ")";
            statusSpan.style.color = "#2d5a2d";
            statusSpan.style.backgroundColor = "#d0e8d0";
        });

        // 2. Handle user selection
        citySelector.addEventListener('change', (e) => {
            const city = e.target.value;
            addLog(`Subscribing to updates for ${city}...`);
            
            // Emit event to server to join the specific room
            socket.emit('subscribe_city', city);
        });

        // 3. Listen for real-time updates from server
        socket.on('temperature_update', (data) => {
            // Update visual temperature
            tempDisplay.textContent = `${data.temp}Â°C`;
            
            // Add a visual "flash" effect
            tempDisplay.classList.remove('highlight');
            void tempDisplay.offsetWidth; // Trigger reflow to restart animation
            tempDisplay.classList.add('highlight');

            // Update logs
            addLog(`[${data.timestamp}] Update: ${data.city} is now ${data.temp}Â°C`);
        });

        function addLog(msg) {
            const div = document.createElement('div');
            div.textContent = msg;
            logBox.prepend(div);
        }
    </script>
</body>
</html>